{"ast":null,"code":"var _jsxFileName = \"/Users/sagisimchi/Documents/GitHub/dent2-client/src/components/articleEditor/ArticleTextEditor.tsx\",\n  _s = $RefreshSig$();\nimport styled from \"styled-components\";\nimport { useFormContext } from \"react-hook-form\";\nimport { Editor } from \"@tinymce/tinymce-react\";\nimport { useCallback, useEffect, useRef } from \"react\";\nimport React from \"react\";\nimport generatorService from \"../../core/services/generator.service\";\nimport { useParams } from \"react-router\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst EditorContainer = styled.div`\n  height: calc(100vh - 85px);\n  overflow: auto;\n`;\n_c = EditorContainer;\nconst ArticleTextEditor = () => {\n  _s();\n  const {\n    getValues,\n    setValue,\n    handleSubmit\n  } = useFormContext();\n  const editorRef = useRef();\n  const selectedElement = useRef();\n  const value = getValues(\"body\");\n  const {\n    articleId\n  } = useParams();\n  const handler = e => {\n    var _selectedElement$curr;\n    (_selectedElement$curr = selectedElement.current) === null || _selectedElement$curr === void 0 ? void 0 : _selectedElement$curr.append(e.detail);\n  };\n  const endStreamHandler = useCallback(() => {\n    var _selectedElement$curr2;\n    if ((_selectedElement$curr2 = selectedElement.current) !== null && _selectedElement$curr2 !== void 0 && _selectedElement$curr2.textContent) setValue(\"body\", editorRef.current.getContent());\n  }, [handleSubmit]);\n  useEffect(() => {\n    document.removeEventListener(\"stream\", handler);\n    document.addEventListener(\"stream\", handler);\n    document.removeEventListener(\"end-stream\", endStreamHandler);\n    document.addEventListener(\"end-stream\", endStreamHandler);\n  }, [endStreamHandler, selectedElement]);\n  const refraseWidget = () => {\n    if (selectedElement.current && selectedElement.current.textContent) {\n      generatorService.regenerateArticleWidget(selectedElement.current.textContent, articleId).then(() => {});\n      selectedElement.current.textContent = \"\";\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(EditorContainer, {\n    className: \"overflow-auto\",\n    children: /*#__PURE__*/_jsxDEV(Editor, {\n      apiKey: \"c6b2eufyb1kx5rbc8jt19dx2gzf74hsovsd0nfpr6kfwdujz\",\n      onInit: (evt, editor) => {\n        editorRef.current = editor;\n        editor.ui.registry.addMenuItem(\"paragraph\", {\n          icon: \"text\",\n          text: \"Regenerate section\",\n          onAction: function () {\n            refraseWidget();\n          }\n        });\n        editor.ui.registry.addMenuItem(\"label\", {\n          icon: \"text\",\n          text: \"Regenerate title\",\n          onAction: function () {\n            refraseWidget();\n          }\n        });\n        editor.ui.registry.addContextMenu(\"test\", {\n          update: function (element) {\n            selectedElement.current = element;\n            console.log(element.tagName);\n            if (element.tagName === \"H1\" || element.tagName === \"H2\" || element.tagName === \"H3\") {\n              return \"label\";\n            } else if (element.tagName === \"P\") return \"paragraph\";\n            return \"\";\n          }\n        });\n        return {\n          language: \"he_IL\"\n        };\n      },\n      onEditorChange: v => setValue(\"body\", v),\n      value: value,\n      init: {\n        height: \"100%\",\n        menubar: false,\n        plugins: [\"advlist\", \"autolink\", \"lists\", \"link\", \"image\", \"charmap\", \"anchor\", \"searchreplace\", \"visualblocks\", \"code\", \"fullscreen\", \"insertdatetime\", \"media\", \"table\", \"code\", \"wordcount\"],\n        toolbar: \"undo redo | blocks | \" + \"bold italic forecolor | alignleft aligncenter \" + \"alignright alignjustify | bullist numlist outdent indent | \" + \"removeformat\",\n        content_style: `@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap');\n          body { font-family:Inter,sans-serif; font-size:14px; padding: 20px 70px; }\n          .header img{border-radius: 12px;border: solid 1px rgb(226, 232, 240); width:100%;height: 400px;object-fit: cover;}\n          .header h1{\n            color: #1C244B;\n            font-size: 42px;\n          font-weight: bold;\n          text-transform: none;\n          font-style: normal;\n          text-decoration: none;\n          line-height: 1.3em;\n          letter-spacing: -1.2px;}\n          li{margin-bottom:10px;}\n          p{color: #0A2540;\n            font-size: 18px;\n            font-weight: 300;\n            text-transform: none;\n            font-style: normal;\n            text-decoration: none;\n            line-height: 2em;\n            letter-spacing: -0.2px;}\n            h3{font-size: 24px;\n              font-weight: 600;}\n              h2{font-size: 32px;\n                font-weight: bold;}\n                a{box-shadow: none;\n                  text-decoration: none;\n                  color: #A960EE !important;\n                }`,\n        contextmenu: \"image link test table\",\n        // add test menu later\n        contextmenu_never_use_native: true\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 5\n  }, this);\n};\n_s(ArticleTextEditor, \"gajetlYrZej6li6isKKN9NlOY9Y=\", false, function () {\n  return [useFormContext, useParams];\n});\n_c2 = ArticleTextEditor;\nexport default _c3 = /*#__PURE__*/React.memo(ArticleTextEditor);\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"EditorContainer\");\n$RefreshReg$(_c2, \"ArticleTextEditor\");\n$RefreshReg$(_c3, \"%default%\");","map":{"version":3,"names":["styled","useFormContext","Editor","useCallback","useEffect","useRef","React","generatorService","useParams","jsxDEV","_jsxDEV","EditorContainer","div","_c","ArticleTextEditor","_s","getValues","setValue","handleSubmit","editorRef","selectedElement","value","articleId","handler","e","_selectedElement$curr","current","append","detail","endStreamHandler","_selectedElement$curr2","textContent","getContent","document","removeEventListener","addEventListener","refraseWidget","regenerateArticleWidget","then","className","children","apiKey","onInit","evt","editor","ui","registry","addMenuItem","icon","text","onAction","addContextMenu","update","element","console","log","tagName","language","onEditorChange","v","init","height","menubar","plugins","toolbar","content_style","contextmenu","contextmenu_never_use_native","fileName","_jsxFileName","lineNumber","columnNumber","_c2","_c3","memo","$RefreshReg$"],"sources":["/Users/sagisimchi/Documents/GitHub/dent2-client/src/components/articleEditor/ArticleTextEditor.tsx"],"sourcesContent":["import ReactQuill from \"react-quill\";\nimport styled from \"styled-components\";\nimport { Article } from \"../../core/entities/article\";\nimport { Controller, useFormContext } from \"react-hook-form\";\nimport { Editor } from \"@tinymce/tinymce-react\";\nimport {\n  forwardRef,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useRef,\n} from \"react\";\nimport React from \"react\";\nimport generatorService from \"../../core/services/generator.service\";\nimport { useParams } from \"react-router\";\n\nconst EditorContainer = styled.div`\n  height: calc(100vh - 85px);\n  overflow: auto;\n`;\n\nconst ArticleTextEditor = () => {\n  const { getValues, setValue, handleSubmit } = useFormContext<Article>();\n  const editorRef = useRef<any>();\n  const selectedElement = useRef<Element>();\n  const value = getValues(\"body\");\n  const { articleId } = useParams();\n\n  const handler = (e: any) => {\n    selectedElement.current?.append(e.detail);\n  };\n\n  const endStreamHandler = useCallback(() => {\n    if (selectedElement.current?.textContent)\n      setValue(\"body\", editorRef.current.getContent());\n  }, [handleSubmit]);\n\n  useEffect(() => {\n    document.removeEventListener(\"stream\", handler);\n    document.addEventListener(\"stream\", handler);\n    document.removeEventListener(\"end-stream\", endStreamHandler);\n    document.addEventListener(\"end-stream\", endStreamHandler);\n  }, [endStreamHandler, selectedElement]);\n\n  const refraseWidget = () => {\n    if (selectedElement.current && selectedElement.current.textContent) {\n      generatorService\n        .regenerateArticleWidget(\n          selectedElement.current.textContent,\n          articleId as string\n        )\n        .then(() => {});\n\n      selectedElement.current.textContent = \"\";\n    }\n  };\n\n  return (\n    <EditorContainer className=\"overflow-auto\">\n      <Editor\n        apiKey=\"c6b2eufyb1kx5rbc8jt19dx2gzf74hsovsd0nfpr6kfwdujz\"\n        onInit={(evt, editor) => {\n          editorRef.current = editor as any;\n\n          editor.ui.registry.addMenuItem(\"paragraph\", {\n            icon: \"text\",\n            text: \"Regenerate section\",\n            onAction: function () {\n              refraseWidget();\n            },\n          });\n\n          editor.ui.registry.addMenuItem(\"label\", {\n            icon: \"text\",\n            text: \"Regenerate title\",\n            onAction: function () {\n              refraseWidget();\n            },\n          });\n\n          editor.ui.registry.addContextMenu(\"test\", {\n            update: function (element: Element) {\n              selectedElement.current = element;\n              console.log(element.tagName);\n              if (\n                element.tagName === \"H1\" ||\n                element.tagName === \"H2\" ||\n                element.tagName === \"H3\"\n              ) {\n                return \"label\";\n              } else if (element.tagName === \"P\") return \"paragraph\";\n              return \"\";\n            },\n          });\n          return { language: \"he_IL\" };\n        }}\n        onEditorChange={(v) => setValue(\"body\", v)}\n        value={value}\n        init={{\n          height: \"100%\",\n          menubar: false,\n          plugins: [\n            \"advlist\",\n            \"autolink\",\n            \"lists\",\n            \"link\",\n            \"image\",\n            \"charmap\",\n            \"anchor\",\n            \"searchreplace\",\n            \"visualblocks\",\n            \"code\",\n            \"fullscreen\",\n            \"insertdatetime\",\n            \"media\",\n            \"table\",\n            \"code\",\n            \"wordcount\",\n          ],\n          toolbar:\n            \"undo redo | blocks | \" +\n            \"bold italic forecolor | alignleft aligncenter \" +\n            \"alignright alignjustify | bullist numlist outdent indent | \" +\n            \"removeformat\",\n          content_style: `@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&display=swap');\n          body { font-family:Inter,sans-serif; font-size:14px; padding: 20px 70px; }\n          .header img{border-radius: 12px;border: solid 1px rgb(226, 232, 240); width:100%;height: 400px;object-fit: cover;}\n          .header h1{\n            color: #1C244B;\n            font-size: 42px;\n          font-weight: bold;\n          text-transform: none;\n          font-style: normal;\n          text-decoration: none;\n          line-height: 1.3em;\n          letter-spacing: -1.2px;}\n          li{margin-bottom:10px;}\n          p{color: #0A2540;\n            font-size: 18px;\n            font-weight: 300;\n            text-transform: none;\n            font-style: normal;\n            text-decoration: none;\n            line-height: 2em;\n            letter-spacing: -0.2px;}\n            h3{font-size: 24px;\n              font-weight: 600;}\n              h2{font-size: 32px;\n                font-weight: bold;}\n                a{box-shadow: none;\n                  text-decoration: none;\n                  color: #A960EE !important;\n                }`,\n          contextmenu: \"image link test table\", // add test menu later\n          contextmenu_never_use_native: true,\n        }}\n      />\n    </EditorContainer>\n  );\n};\n\nexport default React.memo(ArticleTextEditor);\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}